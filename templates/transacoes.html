{% extends 'templateDashboard.html' %}

{% block conteudo %}
<div class="container">
    {% include 'components/sidebar.html' %}

    <main class="panel">
        <h1 class="panel-title">Transações Realizadas</h1>

        <div class="flash-messages-container">
            {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
            {% for category, message in messages %}
            <div class="flash-message flash-{{ category }}">
                <span class="flash-icon">
                    {% if category == 'success' %}
                    ✓
                    {% elif category == 'error' %}
                    ✕
                    {% else %}
                    ℹ
                    {% endif %}
                </span>
                <span class="flash-text">{{ message }}</span>
                <button class="flash-close" onclick="this.parentElement.style.display='none'">&times;</button>
            </div>
            {% endfor %}
            {% endif %}
            {% endwith %}
        </div>

        <div class="balance">
            <span class="label">Saldo Atual:</span>
            {% if saldo <= 0 %}
                <span class="value" style="color: #dc3545">R${{ '%.2f'|format(saldo) }}</span>
            {% else %}
                <span class="value">R${{ '%.2f'|format(saldo) }}</span>
            {% endif %}
        </div>

        <div class="actions-row">
            <a href="{{ url_for('nova_receita') }}" class="cta cta-primary">Nova Receita</a>
            <a href="{{ url_for('nova_despesa') }}" class="cta cta-outline">Nova Despesa</a>
        </div>

        <div class="transacoes-cards-container">
            {% if transacoes %}
            {% for transacao in transacoes %}
            <div class="transacao-card {% if transacao[5] and transacao[5].lower() == 'empréstimo' %}transacao-emprestimo{% endif %}">
                {% if transacao[5] and transacao[5].lower() == 'empréstimo' %}
                <div class="emprestimo-badge">
                    <span class="badge-icon"></span>
                    Parcela de Empréstimo
                </div>
                {% endif %}

                <div class="transacao-card-linha">
                    <span class="transacao-card-label">Data:</span>
                    <span class="transacao-card-value">{{ transacao[4] }}</span>
                </div>
                <div class="transacao-card-linha">
                    <span class="transacao-card-label">Tipo:</span>
                    <span
                        class="transacao-card-value {% if transacao[1].lower() == 'receita' %}receita{% else %}despesa{% endif %}">
                        <!-- CORREÇÃO: Primeira letra maiúscula -->
                        {{ transacao[1].capitalize() }}
                    </span>
                </div>
                <div class="transacao-card-linha">
                    <span class="transacao-card-label">Valor:</span>
                    <span class="transacao-card-value {% if transacao[1].lower() == 'receita' %}valor-receita{% else %}valor-despesa{% endif %}">
                        R$ {{ '%.2f'|format(transacao[2]) }}
                    </span>
                </div>
                <div class="transacao-card-linha">
                    <span class="transacao-card-label">Descrição:</span>
                    <span class="transacao-card-value">{{ transacao[3] }}</span>
                </div>
                <div class="transacao-card-linha">
                    <span class="transacao-card-label">Classificação:</span>
                    <span class="transacao-card-value">
                        {% if transacao[5] %}
                            {{ transacao[5] }}
                        {% else %}
                            Não informada
                        {% endif %}
                    </span>
                </div>
                <div class="transacao-card-actions">
                    {% if transacao[5] and transacao[5].lower() == 'empréstimo' %}
                        <span class="btn-card btn-card-disabled"></span>
                        <span class="btn-card btn-card-info" title="Parcela de empréstimo não pode ser editada ou excluída"></span>
                    {% else %}
                        <a href="{{ url_for('editar_transacao', id_transacao=transacao[0]) }}"
                            class="btn-card btn-card-edit">Editar</a>
                        <form action="{{ url_for('editar_transacao', id_transacao=transacao[0]) }}" method="post"
                            style="display:inline;">
                            <button type="submit" name="excluir" value="1" class="btn-card btn-card-delete">Excluir</button>
                        </form>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
            {% else %}
            <div class="empty-state">
                <h3>Nenhuma transação cadastrada</h3>
            </div>
            {% endif %}
        </div>
    </main>
</div>


{% endblock %}